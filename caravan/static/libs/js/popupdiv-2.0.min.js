function PopupDiv(){var d=jQuery;var n=this;var h={};if(arguments.length&&arguments[0]){h=arguments[0]}var b=d("<div/>");var j=d("<div/>").append(d("<a/>").attr("href","#").click(function(){n.close("closeClicked");return false})).append(" ").append(d("<div/>").css("clear","both"));var c=d("<div/>").css("overflow","auto");var p=d("<div/>").append(d("<a/>").attr("href","#").click(function(){n.trigger("ok");return false}));b.append(j).append(c).append(p);this.getDiv=function(){return b};var o={};this.getListeners=function(){return o};var e;var l;for(e in PopupDiv){var m=PopupDiv[e];if(PopupDiv.hasOwnProperty(e)&&(typeof m!=="function")){if(!l){l={}}l[e]=m}}if(l){var g=true;var i=undefined;if(typeof Object.getPrototypeOf!=="function"){if(typeof this.__proto__==="object"){i=this.__proto__}else{i=this;g=false}}else{i=Object.getPrototypeOf(this)}for(e in l){if(l.hasOwnProperty(e)){i[e]=l[e];if(g){delete PopupDiv[e]}}}}for(e in h){if(h.hasOwnProperty(e)){if(e==="onOk"||e==="onShow"||e==="onClose"){this.bind(e.substring(2).toLowerCase(),h[e])}else{if(e=="content"){this.setContent(h[e])}else{this[e]=h[e]}}}}if(!this.popupCss){this.popupCss={}}}(function(f){var d=jQuery;var g=window;var c=document;var b=d(g);var e="popup_"+(new Date().getTime());f.isClickElement=function(h){return h&&h.length==1&&h instanceof d&&h[0]!==g&&h[0]!==c&&(h.is("a")||h.is("input[type=button]")||h.is("button")||h.is("input[type=submit]"))};f.getId=function(){var h=this.getDiv();if(!(h.attr("id"))){h.attr("id",e+"_"+(new Date().getTime()))}return h.attr("id")};f.shadowOffset=4;f.invoker=b;f.bounds={top:0.25,left:0.25,right:0.25,bottom:0.25};f.boundsExact=false;f.popupClass="";f.popupCss={};f.showOk=false;f.showClose=false;f.title="";f.okButtonClass="";f.okButtonAlign="right";f.closeButtonClass="";f.titleClass="";f.okButtonTitle="Ok";f.closeButtonTitle="x";f.defaultCloseOperation="hide";f.focusable=false;f.fadInTime="fast";f.fadeOutTime=0;f.shadowOpacity=0.25;f.zIndex=10000;f.listItemClass="";f.listItemCss="";f.getFormData=function(){var j=this.find("input,select,textarea");var i={};var h=this.getFormDataAttrName();j.each(function(m,n){var k=d(n);var l=k.attr(h);if(l){i[l]=k.val()}});return i};f.find=function(h){return this.getDiv().children().eq(1).find(h)};f.bind=function(h,j){var i=this.getListeners();if(i.hasOwnProperty(h)){i[h].push(j)}else{i[h]=[j]}};f.unbind=function(i){var j=this.getListeners();if(i&&j.hasOwnProperty(i)){delete j[i]}else{if(!i){for(var h in j){if(j.hasOwnProperty(h)){delete j[h]}}}}};f.trigger=function(h){var k=this.getListeners();var m=this;if(k.hasOwnProperty(h)){var l=k[h];var j=0;if(h=="ok"){var n=this.getFormData();for(j=0;j<l.length;j++){l[j].apply(m,[n])}this.close("okClicked")}else{if(h=="close"){var o="";if(arguments&&arguments.length>1&&typeof arguments[1]==="string"){o=arguments[1]}for(j=0;j<l.length;j++){l[j].apply(m,[o])}}else{for(j=0;j<l.length;j++){l[j].apply(m)}}}}};f.setContent=function(x){var t=this.getDiv();var r=d(d(t).children()[1]);r.empty();var v=this.getFormDataAttrName();if(x instanceof d){r.append(x)}else{if(x instanceof Array){var E=this;var q=d("<input/>").attr("type","hidden").attr(v,"selIndex");var A=function(h,k,i){k.click(function(){i.val(h);E.trigger("ok");return false}).focus(function(){i.val(h)})};var s=d([]);for(var B=0;B<x.length;B++){var C=x[B];var D=d("<a/>").attr("href","#").html(""+C);s=s.add(D);A(B,D,q);r.append(D)}s.css({margin:"2px"});if(this.listItemClass){s.addClass(this.listItemClass)}if(this.listItemCss){s.css(this.listItemCss)}s.css({position:"",display:"block"});r.append(q)}else{if(x&&x.constructor==Object){var j=d([]);var F=d([]);var n=[0,0];var l=function(k,i){var h=d("<div/>");if(!i){i=k;k=d("<span/>")}F=F.add(i);j=j.add(k);r.append(h.append(k).append(i));return h};var H,p;var z=Math.max;var m=undefined;var o=d([]);for(var w in x){if(x.hasOwnProperty(w)){var G=x[w];if(typeof G=="string"||typeof G=="number"){H=d("<span/>").html(w);n[0]=z(n[0],w.length);n[1]=z(n[1],G.length);p=d("<input/>").attr("type","text").val(G).attr(v,w);o=o.add(l(H,p))}else{if(G===true||G===false){var u=this.getId()+"_checkbox";H=d("<input/>").attr("type","checkbox").attr(v,w).attr("id",u);if(G){H.attr("checked","checked")}else{H.removeAttr("checked")}p=d("<label/>").attr("for",u).html(w);n[1]=z(n[1],w.length);o=o.add(l(d("<span/>").append(H),p))}else{if(G instanceof Array){H=d("<span/>").html(w);n[0]=z(n[0],w.length);p=d("<select/>").attr("size",1).attr(v,w);for(var y=0;y<G.length;y++){p.append(d("<option/>").val(G[y]).html(G[y]));n[1]=z(n[1],G[y].length)}o=o.add(l(H,p))}}}if(m){m.css("marginBottom","1ex")}}}o.css({"white-space":"nowrap",marginBottom:"0.5ex"});d(o[o.length-1]).css("marginBottom","");j.add(F).css({display:"inline-block",margin:"0px",padding:"0px"});j.css({textAlign:"right",marginRight:"0.5ex",width:Math.round((3/5)*n[0])+"em"});F.css({width:Math.round((3/5)*z(n[0],n[1]))+"em"})}else{r.append(""+x)}}}};f.setFocusCycleRoot=function(r){var h=this.getDiv();var q=this.getFocusAttr();var j=this.isClickElement(this.invoker);var l=h.children();var s=d(l[0]);var t=d(l[1]);var k=d(l[2]);var n=t.find("input[type!=hidden],select,textarea,a");var o=n.length?d(n[0]):t;if(this.showClose){n=n.add(s.find("a"))}if(this.showOk||this.title){n=n.add(s.find(":text"));if(this.showOk){n=n.add(k.find("a"))}}h.add(t).css("outline","#FFF none 0px");n=n.add(h).add(t);var i="blur."+this.getId();if(!r){n.each(function(u,v){d(v).unbind(i).removeAttr("tabindex").removeAttr(q)});this.getFirstFocusableElement=function(){return undefined};if(j){this.invoker.removeAttr("tabindex").removeAttr(q)}return}if(j){this.invoker.attr("tabindex",0).attr(q,"true")}var m=c;var p=this;n.each(function(v,w){var u=d(w);u.attr(q,"true");u.attr("tabindex",v+1);u.unbind(i).bind(i,function(){setTimeout(function(){var x=m.activeElement;if((x&&d(x).attr(q))||p.__isClosing){return}p.close("focusLost")},200)})});this.getFirstFocusableElement=function(){return o}};f.getFirstFocusableElement=function(){return undefined};f.refresh=function(h,k){var i=this.isShowing();var j=this.focusable;if(h!==undefined){this.setContent(h);if(i&&j){this.setFocusCycleRoot(this.focusable)}}if(k!=undefined){if(i){this.setTitle(k)}else{this.title=k}}if(!i){return}this.setBounds();if(j){this.getFirstFocusableElement().focus()}};f.setTitle=function(k){var i=this.getDiv().children().eq(0);var j=i.contents().filter(function(){return this.nodeType==3});var h=j.get(0);if(!k){k=" "}if(h.textContent){h.textContent=k}else{if(h.nodeValue){h.nodeValue=k}}};f.isShowing=function(){return this.getDiv().is(":visible")};f.show=function(){var h=this.getDiv();var r=this;var o=this.invoker;var m=this.isClickElement(o);this._isClickElement=m;this.setBounds=m?this._setBoundsAsPopup:this._setBoundsInside;this.setOffset=m?this._setOffsetAsPopup:this._setOffsetInside;if(this.popupClass){h.removeClass().addClass(this.popupClass);this.popupClass=""}if(this.popupCss){h.css(this.popupCss);this.popupCss=""}this.setFocusCycleRoot(this.focusable);var p=h.children();var u=d(p[0]);var s=u.find("a").eq(0);if(this.showClose||this.title){u.css({paddingBottom:"0.25em"});if(this.titleClass&&this.title){u.attr("class",this.titleClass);this.titleClass=""}if(this.showClose){s.css("marginLeft","0.5em").attr("class",this.closeButtonClass).html(this.closeButtonTitle).css({display:"inline-block","float":"right"})}else{s.hide()}this.setTitle(this.title)}var i=d(p[2]);var t=i.find("a").eq(0);if(this.showOk){i.css({paddingTop:"0.25em",textAlign:this.okButtonAlign});t.attr("class",this.okButtonClass);t.html(this.okButtonTitle);t.css({"float":"none",display:"inline-block"})}if(!h.parent().length){h.appendTo("body")}if(m){this["_tmpHandlers"+this.getId()]=undefined;var w=this.getFirstFocusableElement();if(w){var n=[];var q="click";var j=o.data("events")[q];d.each(j,function(x,y){n.push(y)});o.unbind(q);this["_tmpHandlers"+this.getId()]=n;o.unbind(q).bind(q,function(x){if(h.length&&h.is(":visible")){w.focus();return false}r.close.apply(r);return false})}}this.setBounds();var v=this._getShadow();var k=this.setOffset;var l=function(){var x=b.width();var z=b.height();r._resizeTimeInterval=setInterval(function(){var A=b.width();var B=b.height();if(A!==x||B!==z){setTimeout(function(){if(!r.isShowing()||r.__isClosing){return}if(b.width()===A&&b.height()===B){k.apply(r)}},100)}},200);r.trigger("show");if(v!==undefined){v.fadeTo(r.fadInTime,r.shadowOpacity,function(){var A=r.getFirstFocusableElement();if(A){A.focus()}})}else{var y=r.getFirstFocusableElement();if(y){y.focus()}}};h.show(this.fadInTime,function(){l()})};f.refreshShadow=function(){var k=this._getShadow();var i=this.shadowOffset;if(!i&&k!==undefined){k.remove()}else{if(i){var j=this.getDiv();if(k===undefined){k=j.clone(false,false).empty().css({backgroundColor:"#000",borderColor:"#000",display:"block",zIndex:this.zIndex-1}).removeAttr("tabindex").removeAttr(this.getFocusAttr()).fadeTo(0,0).attr("id",this.getShadowDivId()).insertAfter(j)}var h=this.getBounds.apply(this);k.css({left:(h.x+i)+"px",top:(h.y+i)+"px",width:(h.width)+"px",height:(h.height)+"px"})}}};f._getShadow=function(){var h=this.getDiv().next("div");if(h&&h.length&&h.attr("id")===this.getShadowDivId()){return h}return undefined};f._setBoundsAsPopup=function(){var o=this.invoker;this.preSizeFcn();var h=this.getDiv();var t=this.shadowOffset;var j=this.getBoundsOf(b);var i=o.offset();var p=o.outerHeight();var n=i.top-j.y;var q=j.height-p-n;var l=n>q&&h.outerHeight(false)+t>q;var k=o.outerWidth();var r=j.x+j.width-i.left;var m=i.left+k-j.x;var s=m>r&&h.outerWidth(false)+t>r;this.setMaxSize({height:(l?n:q),width:(s?m:r)});this.setMinSize({width:o.outerWidth()+this.shadowOffset});this.postSizeFcn()};f._setBoundsInside=function(){var u=this.invoker;var p=this.bounds;var o=this.boundsExact;var j=this.getDiv();this.preSizeFcn();var i=this.getBoundsOf(u);var s=i.x;var q=i.y;var v=i.width;var n=i.height;var m=parseInt;var r={top:p.top,left:p.left,bottom:p.bottom,right:p.right};for(var l in r){if(r.hasOwnProperty(l)){if(r[l]<=0){r[l]=0}else{if(r[l]<=1){r[l]=l=="top"||l=="bottom"?n*r[l]:v*r[l]}else{r[l]=m(r[l])}}}}var t={width:v-r.left-r.right+this.shadowOffset,height:n-r.top-r.bottom+this.shadowOffset};this.setMaxSize({width:t.width,height:t.height});if(o){this.setMinSize({width:t.width,height:t.height})}this.postSizeFcn()};f.preSizeFcn=function(){var k=this.getDiv();var h=k.children();h.css("display","none");var i=h.eq(1);if(this.showClose||this.title){i=i.add(h.eq(0))}if(this.showOk){i=i.add(h.eq(2))}i=i.add(k);i.css({display:"block","float":"",overflow:"visible"});i.css({maxHeight:"",maxWidth:"",minHeight:"",minWidth:"",height:"",width:"",overflow:"",visibility:"visible","float":""});k.css({margin:"0px",zIndex:this.zIndex,position:"absolute"});var j=this.getBoundsOf();k.css({left:j.x+"px",top:j.y+"px"})};f.postSizeFcn=function(){var m=this.getDiv();var i=m.children();var j=i.eq(0);var l=i.eq(1);var h=i.eq(2);var k=(m.height()-j.outerHeight(true)-h.outerHeight(true)-(l.outerHeight(true)-l.height()));if(k>0){l.css("height",k+"px")}l.css("overflow","auto");this.setOffset()};f._setOffsetAsPopup=function(){var h=this.getDiv();var u=this.shadowOffset;var j=this.getBoundsOf(b);var o=this.invoker;var i=o.offset();var p=o.outerHeight();var n=i.top-j.y;var q=j.height-p-n;var l=n>q&&h.outerHeight(false)+u>q;var k=o.outerWidth();var r=j.x+j.width-i.left;var m=i.left+k-j.x;var t=m>r&&h.outerWidth(false)+u>r;var s={left:t?i.left+k-h.outerWidth(true)-u:i.left,top:(l?i.top-h.outerHeight(true):i.top+p)};h.css({top:s.top+"px",left:s.left+"px"});this.refreshShadow()};f._setOffsetInside=function(){var j=this.getDiv();var A=this.invoker;var i=this.getBoundsOf(A);var r=this.bounds;var v=i.x;var s=i.y;var B=i.width;var p=i.height;var n=parseInt;var u={top:r.top,left:r.left,bottom:r.bottom,right:r.right};for(var m in u){if(u.hasOwnProperty(m)){if(u[m]<=0){u[m]=0}else{if(u[m]<=1){u[m]=m=="top"||m=="bottom"?p*u[m]:B*u[m]}else{u[m]=n(u[m])}}}}var z={width:B-u.left-u.right+this.shadowOffset,height:p-u.top-u.bottom+this.shadowOffset};var o=j.outerWidth(true);var l=j.outerHeight(true);var t=0;var q=0;if(o<z.width){t=(z.width-o)/2}if(l<z.height){q=(z.height-l)/2}j.css({left:(v+u.left+t)+"px",top:(s+u.top+q)+"px"});this.refreshShadow()};f.getBounds=function(){return this.getBoundsOf(this.getDiv())};f.getBoundsOf=function(j){var h={x:0,y:0,width:0,height:0};if(!j||!(j instanceof d)){j=b}if(j[0]===g){h.x=j.scrollLeft();h.y=j.scrollTop()}else{var i=j.offset();h.x=i.left;h.y=i.top}h.width=j.width();h.height=j.height();return h};f.setMaxSize=function(i){var j=this.getDiv();this._convertSize(j,i);var h;if(i.hasOwnProperty("width")){if(!h){h={}}h.maxWidth=i.width+"px"}if(i.hasOwnProperty("height")){if(!h){h={}}h.maxHeight=i.height+"px"}if(h){j.css(h)}return i};f.setMinSize=function(i){var j=this.getDiv();this._convertSize(j,i);var h;if(i.hasOwnProperty("width")){if(!h){h={}}h.minWidth=i.width+"px"}if(i.hasOwnProperty("height")){if(!h){h={}}h.minHeight=i.height+"px"}if(h){j.css(h)}return i};f._convertSize=function(j,i){var h={width:j.outerWidth(true)-j.width(),height:j.outerHeight(true)-j.height()};if(i.hasOwnProperty("width")){i.width-=(h.width+this.shadowOffset)}if(i.hasOwnProperty("height")){i.height-=(h.height+this.shadowOffset)}};f.offset=function(h){var i=this.getDiv();i.offset(h)};f.close=function(){this.__isClosing=true;if(this._resizeTimeInterval!==undefined){clearInterval(this._resizeTimeInterval);this._resizeTimeInterval=undefined}this.setFocusCycleRoot(false);var k=this.getDiv();var j=this._getShadow();if(j!==undefined){j.remove()}var i=this;var h=this.defaultCloseOperation=="remove";k.hide(this.fadeOutTime,function(){if(h){k.remove()}var o="_tmpHandlers"+i.getId();if(i[o]){var n=i[o];delete i[o];i.invoker.unbind("click");for(var l=0;l<n.length;l++){var m=n[l];i.invoker.bind(m.type+(m.namespace?"."+m.namespace:""),m.handler)}}delete i.__isClosing;if(arguments&&arguments.length>0&&typeof arguments[0]==="string"){i.trigger("close",arguments[0])}else{i.trigger("close")}})};f.setTimeout=function(i,h){var k=this;var j=undefined;if(i==="show"){j=setTimeout(function(){k.show()},h)}else{if(i==="close"){j=setTimeout(function(){k.close()},h)}}return j};f.getShadowDivId=function(){return this.getId()+"_shadow"};f.getFocusAttr=function(){return this.getId()+"_focus"};f.getFormDataAttrName=function(){return this.getId()+"_data"}})(PopupDiv.prototype);var a=new PopupDiv();