<!DOCTYPE html>
<html>
<!-- 
TODO: implement resize when showing (from parent window)
implement selection and setting
implement url visualization (and link)
implement row count
check why after the col width update thead cells color is blue (??)
 -->
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		
        <link rel="stylesheet" type="text/css" href="css/layout.css"/>
        <link rel="stylesheet" type="text/css" href="css/legend.css"/>
        <link rel="stylesheet" type="text/css" href="css/skin.css"/>
	    <script src="libs/js/jquery-1.11.1.min.js" type="text/javascript"></script>
        
        <style type="text/css">
        	body,html{
        		padding:0;
        		margin:0;
        		border:0;
        		height:100%;
        		width:100%;
        	}
        	body{
        		background-color: transparent; /*for body*/
        		overflow:hidden;
        		overflow-x:auto;
        	}
        </style>
        <script type="text/javascript">
			$(document).ready(function(){
				var $table = $('.fdsn');
				var $thead = $table.find('thead');
				var $tbody = $table.find('tbody');
				var $trs = $tbody.find('tr');
				
				window.getSelectedItem = function(){
					var $tr = $trs.filter('.selected').eq(0);	
					var data= {};
					$tr.find('td').each(function(i,elm){
						var $elm = $(elm);
						var k = $elm.data('submit-key');
						var v = $elm.data('submit-value');
						if(k){
							data[k] = v;
						}
					});
					return data;
				}
				
				
				$tbody.css('height',$table.parent().height()-$thead.outerHeight(true));
				
				if(!$trs.length){return;}
				var $first_row_tds = $trs.eq(0).children('td');
				if(!$first_row_tds.length){return;}
				var sortCol=-1;
				var sortIdx=1;
				var imgs = ['imgs/arrow-down-01-32.png', 'imgs/arrow-up-01-32.png']
				
				window.update = function(){ //globally defined, so that we can call it from parent window
					//set tr height NOW, otherwise setting all anchor text (which are absolute)
					//will set a tr height of 0
					//first remove css style declaration (if any)
					//var $thead_re = $thead.find('tr').eq(0);
					//$thead_re.css('height','');
					//$thead_re.css('height',$thead_re.outerHeight(false));
					$thead.find('td').each(function(i, elm){
						$(elm).css('width', $first_row_tds.eq(i).css('width'));
					});
				};
				
				$trs.click(function(){
					$trs.removeClass('selected');
					$(this).addClass('selected');
				});
				
				$thead.find('td').each(function(i, elm){
					var $elm = $(elm);
					var txt = $elm.html();
					var anchor = $('<a>').attr('href','#').html(txt);
					$elm.html("").append(anchor);
					
					anchor.click(function(){
						var $this = $(this); //might be replaced by anchor which is defined above...
						var $elm = $this.parent(); //the parent td
						if(sortCol === i){
							sortIdx = 1-sortIdx;
						}else{
							sortCol = i;
							sortIdx = 0;
						}
						var fcn = $elm.data('sort') === 'num' ? parseFloat : function(a){return a;};
						$trs.detach();
						if(sortIdx===0){
							$trs.sort(function(a,b){
							    if(fcn($(a).children('td').eq(sortCol).data('value')) < fcn($(b).children('td').eq(sortCol).data('value'))) {
							        return -1;
							    } else {
							        return 1;
							    }
							})
						}else{
							$trs.sort(function(a,b){
							    if(fcn($(a).children('td').eq(sortCol).data('value')) < fcn($(b).children('td').eq(sortCol).data('value'))) {
							        return 1;
							    } else {
							        return -1;
							    }
							});
						}
						
						$tbody.append($trs);
						$thead.find('a').css('background-image', '');
						$this.css('background-image', 'url('+imgs[sortIdx]+')');
					});
				});
				
				window.update();
			});
		</script>
        
        </head>
    <body>
    	
    	
    <!-- this file is autogenerated. For performance reasons end tags will be appended, therefore comment it: -->
<!--     </table> -->
    
<!--     </div> -->
<!--     </body> -->
<!-- </html> -->
